# グラブルの救援IDをOCRでとってくるやつ

## -\*-What is This?-\*-  

グランブルーファンタジーの救援IDを、光学文字認識(OCR)の技術を使ってコピーするアプリです。  
~~JSやF12でID抜くことを悪とする謎集団に対抗した~~  
内部では、画面上の特定の範囲をキャプチャーし、キャプチャーした画像を解析してID文字列を出力しています。  
そのため、グラブルのwebページのソースなどには一切触っていません。  
また、グラブルのID以外の文字列も解析することはできますが、日本語を読み取ることはできません。  

## できること  

+ 下にあるような画面から、救援IDを読み取って、クリップボードにコピーすること  
![この画面](./figure/id_example.PNG)  
  

+ 読み取ったIDをアプリ上で修正してコピーし直すこと  

+ 読み取ったIDを、Google Spread Sheetの任意のセルに入力すること  
  (200615. ver0.20より)

## 使い方  
- [ここ](https://gammasoft.jp/blog/tesseract-ocr-install-on-windows/)を見て、`tesseract`を導入する  
  + 入れる場所は設定ファイル(`config.ini`)にかけるのでどこでもいいですが、`C:\Program Files\Tesseract-OCR`であれば設定の変更がありません。
- [ここらへん](https://tanuhack.com/operate-spreadsheet/)を参考に、Google Drive APIとGoogle Sheets APIを有効化する  
- 認証情報を作成し、取得した`.json`ファイルを`setting`フォルダの中に入れる  
- 同様に参考にして、`config.ini`に必要な情報を書き込む  
- 一通り書き終わったら、`BattleID_OCR.exe`を起動する  
- 起動すると、黒いコンソールと一緒に小さなアプリが立ち上がるので、`Initialize`を押して、IDが写っている箇所を四角く選択する  
- 一度アプリを終了し、もう一度起動する(なぜか再起動しないと座標が更新されない)  
- 再起動すると、`Get ID`でIDを取得できる  

## ボタン説明  

救援IDは一番上の入力欄に入る。  
間違っていた場合は適宜手で修正してから`Copy`なり、`Spread sheet`なりのボタンをクリックしてください。  
- `Initialieze`  
  + 救援IDが写っている位置をアプリに設定する。ブラウザの場所が変わったらもう一度やる必要がある。  
  + また、救援IDを写す窓が`Pause`で最前面に固定されている場合はうまくいかないので、**自発窓のみpauseを外す**
- `Spread sheet`  
  + 登録したシートの特定の場所のセルを書き換える。アプリ内の入力欄に入っている救援IDを直接シートに書き込める  
- `Copy`
  + 現在アプリ内の入力欄に入っている文字列をクリップボードにコピーする。  
- `Get ID`  
  + 救援IDを取得する。画面の指定範囲内に写っていないとダメ。たまに間違う(数字が連続している中のCとか)  
- `Exit`  
  + アプリを終了する.....と思わせておいて何も反応しない(ため、アプリをとじるときは右上の☓から......)  

## 現在判明しているバグ  
200615更新  

+ 再起動しないとうまく撮影座標が`Initialize`されない  
  → アプリを再起動することでうまくいくため、一旦それで対応する。後で直す。

+ 団のシートに書き込んだ場合、自動削除スクリプトが動かない  
  → 内部の処理が噛み合っていない感じ。`update_cells`以外で書き込みメソッドが無いくさいので、対応不可能かもしれない

## TBD; 
+ ~~読み取ったIDを、自分のTwitterアカウントからtweetすること~~  
  → 個々人でやる作業量が多すぎたため、スコープから除外  

+ ~~読み取ったIDを、Google Spread Sheetの任意のセルに入力すること~~  
  実装済  

+ 出力文字列の確信度から、間違っている可能性が高い場合に、ID文字列の第2, 第3候補を出力できるようにする  
  - もしくは、確信度が閾値を下回った文字をハイライトする機能  


